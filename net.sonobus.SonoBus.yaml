app-id: net.sonobus.SonoBus
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: '22.08'
command: sonobus
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --share=network
  - --socket=pulseaudio
  - --filesystem=xdg-download
  - --filesystem=xdg-music
# Jack
  - --filesystem=xdg-run/pipewire-0
  - --system-talk-name=org.freedesktop.RealtimeKit1

add-extensions:
  org.freedesktop.LinuxAudio.Plugins.SonoBus:
    directory: extensions/Plugins/SonoBus
    version: '22.08'
    add-ld-path": lib
    bundle: true
    subdirectories: true
    no-autodownload: true
    autodelete: false
modules:
  - name: SonoBus
    buildsystem: cmake-ninja
    post-install:
      - install -Dm755 SonoBus_artefacts/Standalone/sonobus /app/bin/sonobus
      - install -D images/SonoBus-Icon.svg /app/share/icons/hicolor/scalable/apps/$FLATPAK_ID.svg
      - install -Dm644 $FLATPAK_ID.metainfo.xml /app/share/metainfo/$FLATPAK_ID.metainfo.xml
      - install -Dm644 linux/sonobus.desktop /app/share/applications/${FLATPAK_ID}.desktop
      - desktop-file-edit --set-icon=${FLATPAK_ID} /app/share/applications/${FLATPAK_ID}.desktop
      # VST3 plugin
      - install -d ${FLATPAK_DEST}/extensions/Plugins/SonoBus/vst3
      - cp -R SonoBus_artefacts/VST3/*.vst3 ${FLATPAK_DEST}/extensions/Plugins/SonoBus/vst3
      - cp -R SonoBusInst_artefacts/VST3/*.vst3 ${FLATPAK_DEST}/extensions/Plugins/SonoBus/vst3
      - install -Dm644 -t ${FLATPAK_DEST}/extensions/Plugins/SonoBus/share/metainfo org.freedesktop.LinuxAudio.Plugins.SonoBus.metainfo.xml
      - appstream-compose --basename=org.freedesktop.LinuxAudio.Plugins.SonoBus --prefix=${FLATPAK_DEST}/extensions/Plugins/SonoBus --origin=flatpak org.freedesktop.LinuxAudio.Plugins.SonoBus
    sources:
      - type: git
        url: https://github.com/sonosaurus/sonobus/
        tag: 1.5.1
        commit: 47ed1cfaaee634f26d206a0727cb089319b4ae8d
        x-checker-data:
          type: git
          tag-pattern: ([\d.]+)$
      - type: patch
        path: patches/juce-header.patch
      - type: file
        path: net.sonobus.SonoBus.metainfo.xml
      - type: file
        path: org.freedesktop.LinuxAudio.Plugins.SonoBus.metainfo.xml
